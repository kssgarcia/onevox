# Cross-platform compiler/tooling environment.
# Keep per-OS logic isolated so local shell setup does not break other targets.

case "$(uname -s)" in
Darwin)
  # macOS SDK path for linking
  if command -v xcrun >/dev/null 2>&1; then
    export SDKROOT="$(xcrun --show-sdk-path)"
    export LIBRARY_PATH="/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib:${LIBRARY_PATH:-}"
  fi

  # Prefer clang toolchain on macOS
  export CC=clang
  export CXX=clang++
  ;;
Linux)
  # Prefer clang toolchain on Linux as well (used by native deps / CMake).
  if command -v clang >/dev/null 2>&1; then
    export CC=clang
  fi
  if command -v clang++ >/dev/null 2>&1; then
    export CXX=clang++
  fi

  # Optional hint for bindgen-based crates.
  # onevox uses bundled whisper bindings in Cargo config, so libclang is not required.
  if command -v llvm-config >/dev/null 2>&1; then
    _llvm_libdir="$(llvm-config --libdir 2>/dev/null || true)"
    if [ -n "${_llvm_libdir}" ] && [ -d "${_llvm_libdir}" ]; then
      export LIBCLANG_PATH="${_llvm_libdir}"
    fi
  elif [ -d /usr/lib ]; then
    export LIBCLANG_PATH="/usr/lib"
  fi
  ;;
esac
